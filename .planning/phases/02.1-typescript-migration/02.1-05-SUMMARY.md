---
phase: 02.1-typescript-migration
plan: "05"
subsystem: api

tags: [typescript, cli, commander, smoke-tests, node-test, esm, nodenext, build]

# Dependency graph
requires:
  - phase: 02.1-04
    provides: src/install.ts with runInstall(opts: InstallOptions) — imported by cli.ts
  - phase: 02.1-03
    provides: src/installers/*.ts all migrated to TypeScript
  - phase: 02.1-02
    provides: src/types.ts with InstallOptions and ComponentType interfaces

provides:
  - src/cli.ts with run(): Promise<void> export and program.opts<InstallOptions>() typed options
  - bin/index.js updated to import from ../dist/cli.js (compiled output)
  - test/smoke.test.js with 5 smoke tests using node:test built-in
  - Fully compiled dist/ directory with all .js and .d.ts files
  - Phase 2.1 TypeScript migration 100% complete

affects: [03-discovery-ux, future-phases]

# Tech tracking
tech-stack:
  added:
    - "node:test (built-in, no install required) — smoke test runner"
  patterns:
    - "program.opts<InstallOptions>() — typed commander options via generic parameter"
    - "import type { InstallOptions } from './types.js' — type-only import for CLI options"
    - "JSON.parse(...) as { version: string } — cast pattern for typed JSON reads"
    - "bin/index.js as plain JS shim pointing to dist/ compiled output"

key-files:
  created:
    - src/cli.ts
    - test/smoke.test.js
  modified:
    - bin/index.js
    - package.json

key-decisions:
  - "program.opts<InstallOptions>() used for typed commander option extraction — commander supports generic opts() returning InstallOptions"
  - "import type used for InstallOptions (type-only import) since only used as type annotation, not value"
  - "bin/index.js kept as plain .js shim — no TypeScript needed for single-line entry point"
  - "test/smoke.test.js uses node:test built-in — no additional test framework required for 5 integration checks"

patterns-established:
  - "dist/ shim pattern: bin/ contains plain .js entry pointing to dist/ compiled output"
  - "Smoke test pattern: node:test with existsSync + execSync for CLI artifact and behavior verification"

requirements-completed: []

# Metrics
duration: 2min
completed: 2026-02-24
---

# Phase 02.1 Plan 05: CLI Migration and Phase Completion Summary

**src/cli.ts replaces cli.js with typed commander options, bin/index.js updated to dist/, 5 smoke tests all pass — Phase 2.1 TypeScript migration 100% complete**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-24T17:19:22Z
- **Completed:** 2026-02-24T17:20:59Z
- **Tasks:** 2
- **Files modified:** 4 (2 created, 1 modified, 1 deleted + package.json updated)

## Accomplishments
- Created src/cli.ts with `run(): Promise<void>` export and `program.opts<InstallOptions>()` typed options
- Updated bin/index.js to import from `../dist/cli.js` (compiled output, not src/)
- Deleted src/cli.js — src/ is now 100% TypeScript (.ts only)
- Run full build (`npm run build`) successfully: catalog generated + tsc compiled dist/ with all .js/.d.ts files
- Created test/smoke.test.js with 5 smoke tests (node:test built-in, no framework needed)
- All 5 smoke tests pass: dist/cli.js exists, dist/installers/ exists, components.json exists, --help works, --version works
- npm run lint: 0 errors (3 warnings from pre-existing hook.ts eslint-disable directives, not errors)
- npm pack --dry-run: dist/ included, src/ excluded — correct package contents

## Task Commits

Each task was committed atomically:

1. **Task 1: Migrate src/cli.ts and update bin/index.js** - `dfc43e7` (feat)
2. **Task 2: Run full build, create smoke tests, verify phase success criteria** - `3810636` (feat)

**Plan metadata:** (docs commit follows)

## Files Created/Modified
- `src/cli.ts` - CLI entry point with TypeScript types; run(): Promise<void> export; program.opts<InstallOptions>() for typed options; pkg typed as { version: string }
- ~~`src/cli.js`~~ - Deleted (replaced by src/cli.ts)
- `bin/index.js` - Updated import from ../src/cli.js to ../dist/cli.js
- `test/smoke.test.js` - 5 smoke tests using node:test built-in verifying build artifacts and CLI behavior
- `package.json` - Added "test": "node --test test/smoke.test.js" script

## Decisions Made
- `program.opts<InstallOptions>()` used for typed commander option extraction — commander v14 supports generic `opts<T>()` returning `T`, providing type-safe access to all CLI flags without additional casting
- `import type { InstallOptions }` used (type-only import) since InstallOptions is only needed as a type annotation in `program.opts<InstallOptions>()`, not as a runtime value
- `bin/index.js` kept as plain JavaScript — no need to convert entry shim to TypeScript since it's a one-liner that won't grow; keeping it as .js is simpler and avoids needing tsc to compile bin/
- `test/smoke.test.js` uses Node.js `node:test` built-in with no external test framework — sufficient for 5 integration smoke checks and avoids adding a devDependency

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None. All 5 phase success criteria passed on first attempt with no debugging required.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Phase 2.1 TypeScript migration is 100% complete
- All src/ files are .ts — src/cli.ts, src/install.ts, src/catalog.ts, src/fetch.ts, src/output.ts, src/types.ts, src/installers/*.ts
- dist/ is fully populated with compiled output — CLI works identically to pre-migration
- bin/index.js correctly invokes compiled dist/cli.js
- ESLint passes with 0 errors on all TypeScript source files
- 5 smoke tests pass verifying build artifacts and CLI behavior
- npm pack --dry-run shows correct package contents (dist/ included, src/ excluded)
- Ready for Phase 3: Discovery UX

---
*Phase: 02.1-typescript-migration*
*Completed: 2026-02-24*

## Self-Check: PASSED

- FOUND: src/cli.ts
- CONFIRMED DELETED: src/cli.js
- FOUND: bin/index.js (imports from ../dist/cli.js)
- FOUND: test/smoke.test.js
- FOUND: dist/cli.js
- FOUND: dist/installers/
- FOUND: 02.1-05-SUMMARY.md
- Commit dfc43e7 (Task 1): FOUND
- Commit 3810636 (Task 2): FOUND
