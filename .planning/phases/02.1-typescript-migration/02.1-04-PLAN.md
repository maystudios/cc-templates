---
phase: 02.1-typescript-migration
plan: "04"
type: execute
wave: 3
depends_on: ["02.1-02"]
files_modified:
  - src/install.ts
autonomous: true
requirements: []

must_haves:
  truths:
    - "src/install.ts exists with TypeScript types replacing the JSDoc annotations"
    - "InstallOptions is used as the parameter type for runInstall"
    - "Imports from all dependency modules use .js extension"
    - "src/install.js is deleted"
  artifacts:
    - path: "src/install.ts"
      provides: "Main install orchestrator with TypeScript types"
      exports: ["runInstall"]
  key_links:
    - from: "src/install.ts"
      to: "src/types.ts"
      via: "import { InstallOptions }"
      pattern: "InstallOptions"
    - from: "src/install.ts"
      to: "src/catalog.ts"
      via: "import { validateName }"
      pattern: "validateName"
---

<objective>
Migrate src/install.ts — the main install orchestrator that dispatches to individual installer modules. This file depends on catalog.ts, fetch.ts, output.ts (all migrated in plan 02) and the installer modules (migrated in plan 03 — but install.ts can be migrated in parallel with plan 03 since its imports from the installer files don't need those files to exist yet for tsc to type-check install.ts; tsc checks against the type declarations).

Note: This plan runs in Wave 3 parallel with plan 03. install.ts imports the installer modules, but tsc resolves types from .ts source files — so install.ts can be migrated without waiting for plan 03 to complete, as long as plan 02 (types.ts, catalog.ts, etc.) is done.

Purpose: Isolates the orchestration layer migration into its own focused plan.
Output: src/install.ts (old install.js deleted).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.1-typescript-migration/02.1-CONTEXT.md
@.planning/phases/02.1-typescript-migration/02.1-RESEARCH.md
@.planning/phases/02.1-typescript-migration/02.1-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate src/install.ts</name>
  <files>src/install.ts</files>
  <action>
Read `src/install.js` first to understand the current implementation in full before making changes.

Create `src/install.ts` by renaming install.js to install.ts and adding TypeScript types:

**Key changes:**
1. Import `InstallOptions` from `'./types.js'` — use this as the parameter type for `runInstall`
2. The main exported function signature becomes: `export async function runInstall(opts: InstallOptions): Promise<void>`
3. All imports of other modules use `.js` extension (e.g., `'./catalog.js'`, `'./output.js'`, `'./installers/skill.js'`)
4. Type all local variables where TypeScript cannot infer (e.g., arrays, objects)
5. For `catch (err)` blocks: use `if (err instanceof Error) { ... }` guard or `(err as Error).message` cast
6. Remove JSDoc `@param`/`@returns` annotations — the TypeScript types are now in the function signatures
7. Keep all existing logic exactly unchanged — type-annotation-only migration

**CRITICAL import rule:** All relative imports MUST use `.js` extension:
- `import { validateName } from './catalog.js'` (not .ts)
- `import { runSkillInstall } from './installers/skill.js'` (not .ts)

After creating install.ts, delete install.js.

Run `npx tsc --noEmit` — if there are errors in installer .ts files (plan 03 not yet complete in parallel execution), that is acceptable. Check specifically for errors in `src/install.ts` only.
  </action>
  <verify>
    <automated>npx tsc --noEmit 2>&1 | grep "src/install.ts" | grep -v "^$" || echo "install.ts: no tsc errors"</automated>
    <manual>Confirm src/install.js is deleted. Confirm src/install.ts exists with runInstall(opts: InstallOptions): Promise&lt;void&gt; signature.</manual>
  </verify>
  <done>src/install.ts exists with TypeScript types. InstallOptions used as runInstall parameter type. All imports use .js extension. Old install.js deleted. Zero tsc errors specific to install.ts.</done>
</task>

</tasks>

<verification>
Run: `npx tsc --noEmit 2>&1 | grep "src/install.ts"` — no errors
Run: `ls src/install.*` — shows install.ts only, not install.js
Run: `grep "InstallOptions" src/install.ts` — confirms type is used
</verification>

<success_criteria>
- src/install.ts exists with runInstall(opts: InstallOptions): Promise&lt;void&gt; export
- All relative imports in install.ts use .js extension
- src/install.js deleted
- Zero tsc errors for install.ts
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-typescript-migration/02.1-04-SUMMARY.md`
</output>
