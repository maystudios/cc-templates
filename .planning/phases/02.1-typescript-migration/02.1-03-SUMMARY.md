---
phase: 02.1-typescript-migration
plan: "03"
subsystem: installer
tags: [typescript, installer, write-file-atomic, github-api, cjs-interop]

# Dependency graph
requires:
  - phase: 02.1-02
    provides: "src/types.ts with InstallOptions, GitHubContentsItem interfaces"
provides:
  - "src/installers/agent.ts — Agent installer with TypeScript types"
  - "src/installers/command.ts — Command installer with TypeScript types"
  - "src/installers/hook.ts — Hook installer with write-file-atomic CJS interop typing"
  - "src/installers/skill.ts — Skill installer with GitHubContentsItem typing"
affects: [02.1-04]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Inline call-signature type for CJS interop (path: string, data: string) => Promise<void>"
    - "GitHubContentsItem[] cast on res.json() for GitHub Contents API responses"
    - "Return type Promise<{ success: boolean; reason?: string }> for installer functions"

key-files:
  created:
    - src/installers/agent.ts
    - src/installers/command.ts
    - src/installers/hook.ts
    - src/installers/skill.ts
  modified: []

key-decisions:
  - "write-file-atomic typed via inline call-signature rather than import type (export= CJS interop)"
  - "hookData and settings JSON typed as Record<string,any> with eslint-disable comments — JSON shape is dynamic"
  - "downloadDirectory opts parameter typed as InstallOptions (not a subset) for consistency"

patterns-established:
  - "CJS interop typing: cast require() result to explicit call-signature type instead of import type"
  - "GitHub API JSON: cast res.json() to GitHubContentsItem[] directly after status checks"

requirements-completed: []

# Metrics
duration: 2min
completed: 2026-02-24
---

# Phase 02.1 Plan 03: Installer TypeScript Migration Summary

**Four installer files migrated to TypeScript: InstallOptions on all, write-file-atomic CJS interop typed via call-signature, GitHubContentsItem cast for GitHub Contents API responses**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-24T17:12:09Z
- **Completed:** 2026-02-24T17:14:08Z
- **Tasks:** 2
- **Files modified:** 4 created, 4 deleted

## Accomplishments

- Migrated all four installer files from JavaScript to TypeScript with zero tsc errors
- Preserved write-file-atomic try/catch CJS interop logic in hook.ts, adding type annotation via inline call-signature
- Applied GitHubContentsItem[] cast on GitHub Contents API JSON response in skill.ts
- InstallOptions used as the opts parameter type in all four installer files

## Task Commits

Each task was committed atomically:

1. **Task 1: Migrate agent.ts and command.ts** - `006bd49` (feat)
2. **Task 2: Migrate hook.ts and skill.ts** - `8a7562a` (feat)

## Files Created/Modified

- `src/installers/agent.ts` — Agent installer with InstallOptions type, Promise return type
- `src/installers/command.ts` — Command installer with InstallOptions type, Promise return type
- `src/installers/hook.ts` — Hook installer with write-file-atomic CJS interop typed as call-signature
- `src/installers/skill.ts` — Skill installer with GitHubContentsItem[] for GitHub Contents API response
- `src/installers/agent.js` — Deleted
- `src/installers/command.js` — Deleted
- `src/installers/hook.js` — Deleted
- `src/installers/skill.js` — Deleted

## Decisions Made

- `write-file-atomic` uses `export =` (CJS-style type declaration), so `import type { default as WriteFileAtomic }` does not apply. Typed the variable directly as `(path: string, data: string) => Promise<void>` to capture the call signature used in this codebase.
- `hookData` and the `existing` settings JSON are typed as `Record<string, any>` because the shape is driven by external JSON files and deeply dynamic. ESLint disable comments added inline.
- `downloadDirectory` accepts full `InstallOptions` rather than a subset `{ verbose?: boolean }` for simplicity and forward compatibility.

## Deviations from Plan

None — plan executed exactly as written. The write-file-atomic typing approach differed slightly from the plan's suggested `import type { default as WriteFileAtomic }` pattern because that pattern does not apply to `export =` declarations, but this was resolved inline without needing a rule deviation.

## Issues Encountered

- `@types/write-file-atomic` uses `export =` (CommonJS-style) rather than `export default`, so the plan's suggested `import type { default as WriteFileAtomic }` pattern does not work. Resolved by typing the variable directly with its call signature. No change to logic, just a different typing approach.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- All four installer .ts files ready with proper types
- install.ts migration (plan 04) can now import from typed installer modules
- Zero tsc errors across full project

---
*Phase: 02.1-typescript-migration*
*Completed: 2026-02-24*
