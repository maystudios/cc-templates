---
phase: 03-discovery-ux
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/list.ts
autonomous: true
requirements:
  - DISC-02

must_haves:
  truths:
    - "Running `npx cc-templates --list` prints all components grouped by type with section headers"
    - "Each component entry shows name, description, and author attribution"
    - "Output is colored (chalk) when stdout is a TTY, plain text when piped"
    - "A summary count appears at the bottom: 'N components available across M types'"
    - "Empty sections (types with no catalog entries) are skipped entirely"
  artifacts:
    - path: "src/list.ts"
      provides: "Grouped catalog listing with TTY-aware chalk formatting (DISC-02)"
      min_lines: 35
      exports: ["printList"]
  key_links:
    - from: "src/list.ts"
      to: "src/catalog.ts"
      via: "getAvailable(type) for each ComponentType"
      pattern: "getAvailable"
    - from: "src/list.ts"
      to: "chalk"
      via: "chalk.bold() for headers, chalk.cyan() for names, chalk.dim() for author/description"
      pattern: "chalk\\."
---

<objective>
Create src/list.ts — the --list formatted catalog output module.

Purpose: Lets users browse all available components with descriptions and author attribution without knowing names in advance (DISC-02). No new dependencies needed — chalk 5 is already installed.
Output: src/list.ts exporting printList(), TTY-aware grouped output.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/03-discovery-ux/03-CONTEXT.md
@.planning/phases/03-discovery-ux/03-RESEARCH.md
@src/catalog.ts
@src/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create src/list.ts — grouped catalog listing</name>
  <files>src/list.ts</files>
  <action>
    Create `src/list.ts` implementing the --list formatted output. This file is NEW — create it from scratch.

    **Imports:**
    ```typescript
    import chalk from 'chalk';
    import { getAvailable } from './catalog.js';
    import type { ComponentType } from './types.js';
    ```

    **Constants:**
    ```typescript
    const TYPES: ComponentType[] = ['skill', 'agent', 'command', 'hook'];

    const TYPE_LABELS: Record<ComponentType, string> = {
      skill: 'Skills',
      agent: 'Agents',
      command: 'Commands',
      hook: 'Hooks',
      mcp: 'MCP',
    };
    ```

    **printList() function** — exported void function:

    1. `const isTTY = Boolean(process.stdout.isTTY);`
    2. Track `let total = 0; let typeCount = 0;`
    3. Loop over TYPES:
       - `const entries = getAvailable(type);`
       - If `entries.length === 0` → `continue` (skip empty sections entirely — locked decision)
       - Increment `typeCount++; total += entries.length;`
       - Print section header: `## ${TYPE_LABELS[type]}`
         - TTY: `console.log(chalk.bold(`## ${TYPE_LABELS[type]}`))`
         - Non-TTY: `console.log(`## ${TYPE_LABELS[type]}`)`
       - Print blank line: `console.log()`
       - For each entry:
         - `const name = entry.name ?? '(unknown)';`
         - `const desc = entry.description ?? '';`
         - `const author = entry.author ? `  by ${entry.author}` : '';`
         - TTY mode:
           - `console.log(`  ${chalk.cyan(name)}${chalk.dim(author)}`)`
           - If desc: `console.log(`    ${chalk.dim(desc)}`)`
         - Non-TTY mode:
           - `console.log(`  ${name}${author}`)`
           - If desc: `console.log(`    ${desc}`)`
       - Print blank line after section: `console.log()`
    4. Summary line (locked decision format):
       - `const summary = `${total} component${total !== 1 ? 's' : ''} available across ${typeCount} type${typeCount !== 1 ? 's' : ''}`;`
       - TTY: `console.log(chalk.dim(summary))`
       - Non-TTY: `console.log(summary)`

    **Notes:**
    - chalk 5 auto-suppresses ANSI when stdout is not a TTY — the explicit `isTTY` check is needed for structural decisions (empty lines, section headers) which should always print, not just for color gating
    - Do NOT add `--list` to cli.ts in this plan — that is done in plan 04 (wiring plan)
    - Do NOT filter by mcp type in the TYPES array — mcp is omitted since there are no mcp entries in v0.1
  </action>
  <verify>
    <automated>npm run build 2>&1 | tail -5 && node --input-type=module --eval "import { printList } from './dist/list.js'; console.log(typeof printList);"</automated>
    <manual>After build: dist/list.js exists, typeof printList is 'function'</manual>
  </verify>
  <done>src/list.ts compiles without TypeScript errors; dist/list.js exists after `npm run build`; printList export resolves as a function</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero TypeScript errors on src/list.ts
2. `node -e "import('./dist/list.js').then(m => console.log(typeof m.printList))"` prints `function`
3. Code inspection: TYPES array contains exactly ['skill', 'agent', 'command', 'hook']
4. Code inspection: TTY guard is present — `const isTTY = Boolean(process.stdout.isTTY)`
5. Code inspection: Empty sections are skipped via `if (entries.length === 0) continue`
6. Code inspection: Summary count uses the locked format string
</verification>

<success_criteria>
- src/list.ts exists and exports printList()
- TypeScript compiles src/list.ts without errors
- TTY-aware output: chalk styling when TTY, plain text when piped
- Each entry shows: name (cyan in TTY), description (dim indent), author attribution (dim " by <name>")
- Summary count line at the bottom matches locked format: "N components available across M types"
- Empty catalog sections are silently skipped
</success_criteria>

<output>
After completion, create `.planning/phases/03-discovery-ux/03-02-SUMMARY.md` with:
- Confirmation that src/list.ts was created and compiles
- Note on how isTTY gating was implemented (structural vs chalk auto-detection)
- Any TypeScript issues encountered and resolution
</output>
